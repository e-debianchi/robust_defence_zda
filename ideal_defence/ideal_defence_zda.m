M = [0.125 0 0
     0 0.034 0
     0 0 0.016];

D = [0.125 0 0
     0 0.068 0
     0 0 0.048];

tau1 = 20;
omega20 = 1.3e-2;
K0 = [-9 -6];
tau2 = 0.33;

L = [0.058 0 0 -0.058 0 0 0 0 0
     0 0.063 0 0 -0.063 0 0 0 0
     0 0 0.059 0 0 -0.059 0 0 0
     -0.058 0 0 0.235 0 0 -0.085 -0.092 0
     0 -0.063 0 0 0.296 0 -0.161 0 -0.072
     0 0 -0.059 0 0 0.330 0 -0.170 -0.101
     0 0 0 -0.085 -0.161 0 0.246 0 0
     0 0 0 -0.092 0 -0.170 0 0.262 0
     0 0 0 0 -0.072 -0.101 0 0 0.173];

Lgg = L(1:3, 1:3);
Lgl = L(1:3, 4:9);
Llg = L(4:9, 1:3);
Lll = L(4:9, 4:9);

A = [zeros(3, 3) eye(3)
     inv(M)*(-Lgg + Lgl * inv(Lll) * Llg) -inv(M) * D];

B = [zeros(3, 3); inv(M)];
Ba = B(:, 2);
Bp = B(:, 3);
Cp = [0 0 1 0 0 0];
r = 2;

T1 = [Cp; Cp*A];
T0 = [1 0 0 0 0 0
      0 1 0 0 0 0
      0 0 0 1 0 0
      0 0 0 0 1 0];

T = [T0; T1];
T_inv = inv(T);
T0_inv = T_inv(:, 1:4);
T1_inv = T_inv(:, 5:6);

F0 = T0*A*T0_inv;
G0 = T0*A*T1_inv;
H0 = Cp*(A^r)*T0_inv;
K = Cp*(A^r)*T1_inv;
G0a = T0*Ba;
b = Cp*(A^(r-1))*Bp;

Ka = (-1)*acker(F0, G0a, [1/tau1 1/tau1 1/tau1 1/tau1]);
